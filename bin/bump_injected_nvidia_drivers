#!/bin/sh

. /sabayon/bin/kernels.inc

packages="~x11-drivers/nvidia-drivers-173.14.35 ~x11-drivers/nvidia-drivers-304.64" # ~x11-drivers/nvidia-drivers-96.43.20"
non_injected_packages="~x11-drivers/nvidia-userspace-173.14.35 ~x11-drivers/nvidia-userspace-304.64" # ~x11-drivers/nvidia-userspace-96.43.20"
ETP_REPO="${ETP_REPO:-sabayon-limbo}"

rm -rf /usr/portage/packages/x11-drivers/*
emerge -B ${non_injected_packages} || exit 1
eit inject --to ${ETP_REPO} /usr/portage/packages/x11-drivers/* || exit 1

for kernel in $kernels; do
        mypackages="${packages}"
        # build for latest kernel
        rm -rf /usr/portage/packages/x11-drivers/*
        KERNEL_DIR="/usr/src/linux-${kernel}" emerge -B ${mypackages} || exit 1
        eit inject --to ${ETP_REPO} /usr/portage/packages/x11-drivers/*
        echo
done
