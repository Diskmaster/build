#!/bin/sh

kernels="2.6.36-sabayon 2.6.37-sabayon 2.6.38-sabayon 2.6.39-sabayon"
packages="~x11-drivers/nvidia-drivers-173.14.30" # ~x11-drivers/nvidia-drivers-96.43.19"
non_injected_packages="~x11-drivers/nvidia-userspace-173.14.30" # ~x11-drivers/nvidia-userspace-96.43.19"
ETP_REPO="${ETP_REPO:-sabayon-limbo}"

rm -rf /usr/portage/packages/x11-drivers/*
emerge -B ${non_injected_packages} || exit 1
reagent inject /usr/portage/packages/x11-drivers/* || exit 1

for kernel in $kernels; do
        mypackages="${packages}"
        # build for latest kernel
        rm -rf /usr/portage/packages/x11-drivers/*
        KERNEL_DIR="/usr/src/linux-${kernel}" emerge -B ${mypackages} || exit 1
        reagent inject /usr/portage/packages/x11-drivers/*
        echo
done
